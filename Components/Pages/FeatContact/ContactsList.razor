@using KonnClient.Data
@using KonnClient.Data.Models

<div class="flex flex-col gap-y-[20px] w-full max-w-[800px]">
    <div class="flex justify-between items-center w-full">
        <div class="gap-x-[12px]">
            <div class="">
                <span class="text-lg text-pText font-semibold">Contacts</span>
            </div>
            <span class="text-sText/40 font-medium">
                Invite subscribers, contacts and past guests via email or SMS.
            </span>
        </div>

        <KonnButton Text="New Contact" />
    </div>

    <InputText id="search" @bind-Value="@SearchValue" placeholder="Search a contact" class="px-[14px] py-[8px] border border-border rounded-[12px] transition-all easei-in-out bg-qBackground hover:bg-primary/10 focus:bg-pBackground cursor-pointer focus:cursor-text" />

    <div class="flex flex-col space-y-[12px]">
       <Virtualize Context="contact" ItemsProvider="LoadContacts" OverscanCount="6">
            <ItemContent>
                <ContactRow @key="contact.Id" Contact="@contact" WorkspaceId="@WorkspaceId" />
            </ItemContent>

            <Placeholder>
                <p>loading...</p>
            </Placeholder>

            <EmptyContent>
                <p>
                    There are no contacts to display.
                </p>
            </EmptyContent>
        </Virtualize>
    </div>

    <span class="text-sText/40 font-medium text-[14px]">Learn more about adding contacts</span>
</div>

@code {
    [Parameter]
    public string WorkspaceId { get; set; } = string.Empty;

    public string SearchValue { get; set; } = string.Empty;

    public List<Contact> Contacts { get; set; } = default!;

    private async ValueTask<ItemsProviderResult<Contact>> LoadContacts(ItemsProviderRequest request)
    {
        // Simulate fetching data from a service with a slight delay
        await Task.Delay(500);

        // Fetch the contacts and total count from the service
        var result = await MockDataService.GetContacts(request.StartIndex, request.Count);

        // Return the fetched contacts and the total count
        return new ItemsProviderResult<Contact>(result.Contacts, result.TotalCount);
    }
}
